<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title data-translate="nav.testimonials">Testimonios</title>
  <link href="imagenes/koala.png" rel="icon" />
  <link href="css/index.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #004d00;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      flex-grow: 1;
      padding: 30px 15px;
      background: #e0f7e9;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #2e7d32;
    }

    /* Carrusel testimonios */
    .testimonial-carousel-container {
      position: relative;
      max-width: 1000px;
      margin: 0 auto 40px auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 15px 50px; /* espacio para flechas */
      overflow: hidden;
    }
    .testimonial-carousel-track {
      display: flex;
      transition: transform 0.4s ease;
      will-change: transform;
      user-select: none;
    }
    .testimonial {
      flex: 0 0 300px;
      margin-right: 20px;
      background: #f5fff8;
      border-radius: 8px;
      padding: 20px;
      font-style: italic;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
    }
    .testimonial p {
      margin: 0 0 10px 0;
      flex-grow: 1;
    }
    .testimonial .author {
      font-weight: bold;
      font-style: normal;
      text-align: right;
      color: #388e3c;
      margin-bottom: 10px;
    }

    /* Like button & counter */
    .like-section {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 8px;
      user-select: none;
    }
    .like-button {
      background: #4caf50;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.9rem;
      transition: background 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .like-button.liked {
      background: #2e7d32;
    }
    .like-button:hover {
      background: #388e3c;
    }
    .like-count {
      font-weight: bold;
      color: #2e7d32;
      min-width: 24px;
      text-align: center;
    }

    /* Flechas */
    .carousel-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: #4caf50;
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
      z-index: 10;
    }
    .carousel-arrow:hover {
      background: #388e3c;
    }
    .carousel-arrow.left {
      left: 10px;
    }
    .carousel-arrow.right {
      right: 10px;
    }

    /* Formulario de reseñas */
    #reviewSection {
      max-width: 700px;
      margin: 0 auto 60px auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 25px;
    }
    #reviewSection label {
      font-weight: bold;
      display: block;
      margin-bottom: 8px;
      color: #2e7d32;
    }
    #reviewSection textarea {
      width: 100%;
      min-height: 80px;
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      resize: vertical;
    }
    #reviewSection button {
      background: #4caf50;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s ease;
    }
    #reviewSection button:hover {
      background: #388e3c;
    }
    #loginMessage {
      max-width: 700px;
      margin: 20px auto;
      text-align: center;
      font-weight: bold;
      color: #8b0000;
    }

    /* Footer simple */
    footer {
     background-color: #222;
     color: white;
     padding: 15px 20px;
     text-align: center;
     font-size: 14px;
    }   
      
      .btn-volver {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background-color: #009345;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 25px;
      font-size: 16px;
      cursor: pointer;
      text-decoration: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
      z-index: 9999;
    }
    .btn-volver:hover {
      background-color: #00722e;
    }


  </style>
</head>

<header>
  <nav class="menu-container">
    <div class="menu-icon" onclick="toggleMenu()" aria-label="Abrir menú" role="button" tabindex="0">&#9776;</div>
    <div id="side-menu" class="side-menu" aria-hidden="true">
      <ul>
        <li><a href="nosotros.html">Sobre nosotros</a></li>
        <li><a href="contacto.html">Contacto</a></li>
        <li><a href="galeria.html">Galería interactiva</a></li>
        <li><a href="suscripcion.html">Suscripción</a></li>
        <li><a href="mapa_interactivo.html">Descubra Costa Rica</a></li>
        <li><a href="encuesta.html">Votación de la comunidad</a></li>
        <li><a href="galeria.html">Galería de vida silvestre</a></li>
        <li><a href="testimonios.html">Testimonios</a></li>
        <li><a href="recursos_externos.html">Recursos externos</a></li>
      </ul>
    </div>
  </nav>
</header>

<body>

  <section class="bannerweb" aria-label="Banner con título e imagen de fondo">
    <h1 class="bandera-texto" data-translate="nav.testimonials">Testimonios</h1>
    <div class="subtitulo" data-translate="banner.subtitle">Turismo Interactivo y recomendaciones de viaje</div>
  </section>

  <main>
    <h2 data-translate="nav.testimonials">Testimonios de usuarios</h2>

    <div class="testimonial-carousel-container" aria-label="Carrusel de testimonios">
      <button class="carousel-arrow left" aria-label="Testimonios anteriores">&#10094;</button>
      <div class="testimonial-carousel-track" id="testimonialTrack" tabindex="0">
        <!-- Testimonios se inyectan aquí -->
      </div>
      <button class="carousel-arrow right" aria-label="Testimonios siguientes">&#10095;</button>
    </div>

    <div id="loginMessage" style="display:none;" data-translate="testimonials.loginMessage">
      Para dejar una reseña debe iniciar sesión.
    </div>

    <section id="reviewSection" style="display:none;">
      <form id="reviewForm">
        <label for="reviewText" data-translate="testimonials.leaveReviewLabel">Deja tu reseña:</label>
        <textarea id="reviewText" placeholder="Escribe tu reseña aquí..." data-translate-placeholder="testimonials.leaveReviewPlaceholder"></textarea>
        <button type="submit" data-translate="buttons.submitReview">Enviar reseña</button>
      </form>
    </section>
  </main>

  <footer>
    &copy; 2025 Perezosos Pura Vida - Todos los derechos reservados.
  </footer>

  <script>
    (function(){
      // Traducciones para esta página
      const translations = {
        es: {
          "nav.testimonials": "Testimonios",
          "banner.subtitle": "Turismo Interactivo y recomendaciones de viaje",
          "testimonials.loginMessage": "Para dejar una reseña debe iniciar sesión.",
          "testimonials.leaveReviewLabel": "Deja tu reseña:",
          "testimonials.leaveReviewPlaceholder": "Escribe tu reseña aquí...",
          "buttons.submitReview": "Enviar reseña",
          "buttons.like": "Me gusta"
        },
        en: {
          "nav.testimonials": "Testimonials",
          "banner.subtitle": "Interactive Tourism and Travel Recommendations",
          "testimonials.loginMessage": "You must be logged in to leave a review.",
          "testimonials.leaveReviewLabel": "Leave your review:",
          "testimonials.leaveReviewPlaceholder": "Write your review here...",
          "buttons.submitReview": "Submit review",
          "buttons.like": "Like"
        }
      };

      // Demo testimonios hardcodeados
      const demoTestimonials = [
        {id: 'demo1', author: "Ana M.", text: "Una experiencia inolvidable, ¡muy recomendado!"},
        {id: 'demo2', author: "Carlos R.", text: "Excelente atención y el tour virtual es impresionante."},
        {id: 'demo3', author: "Lucía G.", text: "Me ayudaron a planear mis vacaciones soñadas."},
        {id: 'demo4', author: "Miguel T.", text: "La mejor agencia de turismo que he conocido."},
        {id: 'demo5', author: "Sofía P.", text: "Recomendado para quienes aman la naturaleza y aventura."}
      ];

      const track = document.getElementById('testimonialTrack');
      const leftBtn = document.querySelector('.carousel-arrow.left');
      const rightBtn = document.querySelector('.carousel-arrow.right');
      const reviewSection = document.getElementById('reviewSection');
      const loginMsg = document.getElementById('loginMessage');
      const reviewForm = document.getElementById('reviewForm');
      const reviewText = document.getElementById('reviewText');

      let lang = localStorage.getItem('siteLang') || 'es';

      // Traduce texto y placeholder
      function applyTranslation(){
        document.querySelectorAll('[data-translate]').forEach(el => {
          const key = el.getAttribute('data-translate');
          if(!key) return;
          const txt = translations[lang][key];
          if(txt) el.textContent = txt;
        });
        document.querySelectorAll('[data-translate-placeholder]').forEach(el=>{
          const key = el.getAttribute('data-translate-placeholder');
          if(!key) return;
          const txt = translations[lang][key];
          if(txt) el.placeholder = txt;
        });
      }

      // Comprueba login
      function isLoggedIn(){
        return !!localStorage.getItem('loggedInUser');
      }

      // Recuperar likes guardados
      function getLikes(){
        return JSON.parse(localStorage.getItem('testimonialLikes') || '{}');
      }
      // Guardar likes
      function saveLikes(likes){
        localStorage.setItem('testimonialLikes', JSON.stringify(likes));
      }

      // Renderizar testimonios con likes
      function renderTestimonials(){
        track.innerHTML = "";
        let stored = JSON.parse(localStorage.getItem('userTestimonials') || '[]');
        let all = demoTestimonials.concat(stored);

        const likes = getLikes();
        const user = localStorage.getItem('loggedInUser') || null;

        all.forEach(item => {
          const div = document.createElement('div');
          div.className = 'testimonial';
          div.tabIndex = 0;
          div.setAttribute('aria-label', `Testimonio de ${item.author}`);

          // Obtener likes para este testimonio, default 0
          const likeCount = likes[item.id] ? likes[item.id].count : 0;
          // Saber si el usuario ya dio like a este testimonio
          const likedByUser = likes[item.id] && user && likes[item.id].users.includes(user);

          div.innerHTML = `
            <p>"${item.text}"</p>
            <div class="author">- ${item.author}</div>
            <div class="like-section">
              <button class="like-button ${likedByUser ? 'liked' : ''}" aria-label="${likedByUser ? 'Quitar me gusta' : 'Dar me gusta'}" data-id="${item.id}">
                &#x1F44D; <span>${translations[lang]["buttons.like"]}</span>
              </button>
              <div class="like-count" aria-live="polite">${likeCount}</div>
            </div>
          `;
          track.appendChild(div);
        });

        // Agregar eventos a botones de like
        track.querySelectorAll('.like-button').forEach(btn => {
          btn.addEventListener('click', () => {
            if(!isLoggedIn()){
              alert(lang === 'es' ? 'Debe iniciar sesión para dar me gusta.' : 'You must be logged in to like.');
              return;
            }
            const id = btn.getAttribute('data-id');
            const user = localStorage.getItem('loggedInUser');
            const likes = getLikes();

            if(!likes[id]){
              likes[id] = {count: 0, users: []};
            }

            if(likes[id].users.includes(user)){
              // Quitar like
              likes[id].count--;
              likes[id].users = likes[id].users.filter(u => u !== user);
              btn.classList.remove('liked');
              btn.setAttribute('aria-label', translations[lang]["buttons.like"]);
            } else {
              // Agregar like
              likes[id].count++;
              likes[id].users.push(user);
              btn.classList.add('liked');
              btn.setAttribute('aria-label', 'Quitar me gusta');
            }
            saveLikes(likes);

            // Actualizar contador en pantalla
            const countDiv = btn.nextElementSibling;
            countDiv.textContent = likes[id].count;
          });
        });
      }

      // Mostrar formulario o mensaje según login
      function updateFormVisibility(){
        if(isLoggedIn()){
          reviewSection.style.display = "block";
          loginMsg.style.display = "none";
        } else {
          reviewSection.style.display = "none";
          loginMsg.style.display = "block";
        }
      }

      // Manejo carrusel circular
      let position = 0;
      const cardWidth = 320; // ancho testimonial + margin (300 + 20)

      function updateCarousel(){
        const containerWidth = track.parentElement.offsetWidth;
        const maxVisible = Math.floor(containerWidth / cardWidth);
        const totalCards = track.children.length;
        const maxPosition = -cardWidth * (totalCards - maxVisible);

        if(position < maxPosition) position = maxPosition;
        if(position > 0) position = 0;

        track.style.transform = `translateX(${position}px)`;
      }

      rightBtn.addEventListener('click', () => {
        const containerWidth = track.parentElement.offsetWidth;
        const maxVisible = Math.floor(containerWidth / cardWidth);
        const totalCards = track.children.length;
        const maxPosition = -cardWidth * (totalCards - maxVisible);

        position -= cardWidth;
        if(position < maxPosition){
          position = 0;
        }
        updateCarousel();
      });

      leftBtn.addEventListener('click', () => {
        const containerWidth = track.parentElement.offsetWidth;
        const maxVisible = Math.floor(containerWidth / cardWidth);
        const totalCards = track.children.length;
        const maxPosition = -cardWidth * (totalCards - maxVisible);

        position += cardWidth;
        if(position > 0){
          position = maxPosition;
        }
        updateCarousel();
      });

      // Enviar reseña
      reviewForm.addEventListener('submit', e => {
        e.preventDefault();
        const text = reviewText.value.trim();
        if(text.length < 5){
          alert(lang === 'es' ? 'Por favor escribe una reseña más larga.' : 'Please write a longer review.');
          return;
        }
        const user = localStorage.getItem('loggedInUser');
        let stored = JSON.parse(localStorage.getItem('userTestimonials') || '[]');

        // Crear ID único para la reseña nueva (timestamp + user)
        const newId = 'user_' + user + '_' + Date.now();

        stored.push({id: newId, author: user, text: text});
        localStorage.setItem('userTestimonials', JSON.stringify(stored));
        reviewText.value = "";
        renderTestimonials();
        alert(lang === 'es' ? '¡Gracias por tu reseña!' : 'Thank you for your review!');
      });

      // Al cargar
      document.addEventListener('DOMContentLoaded', () => {
        applyTranslation();
        renderTestimonials();
        updateFormVisibility();
        updateCarousel();
        window.addEventListener('resize', updateCarousel);
      });

    })();
  </script>

  <script src="js/menu.js"></script>

  <a href="index.html" class="btn-volver">← Volver  </a>

</body>
</html>
